# 期权交易分析工具

这是一个用于分析期权交易盈亏平衡点、利润分析等功能的Python工具。支持sell call和sell put期权的详细分析，帮助投资者更好地理解期权交易的风险和收益。

## ✨ 功能特点

### 核心计算功能
1. **行权利润计算**：如果到期被行权，计算利润（考虑期权费和执行价与成本的差额）
2. **利润百分比**：行权利润 ÷ 持仓总金额 × 100%
3. **盈亏平衡价格**：
   - 亏损平衡价：股价跌到多少开始亏损
   - 盈利平衡价：股价涨到多少开始无利润（针对sell call）

### 输出格式
- 支持每笔期权交易单独计算
- 按股票汇总显示总利润、加权均价和盈亏平衡价
- 生成汇总表格，支持CSV和Excel格式输出
- 可视化图表显示各股票的盈亏平衡情况
- 自动创建带时间戳的输出目录

## 🚀 快速开始

### 安装依赖
```bash
pip install -r requirements.txt
```

### 创建示例数据
```bash
python options_analyzer.py --create-sample
```

### 运行分析
```bash
# 基本分析
python options_analyzer.py --input 示例期权数据.csv

# 生成图表
python options_analyzer.py --input 示例期权数据.csv --plot

# 保存为Excel格式
python options_analyzer.py --input 示例期权数据.csv --format excel
```

## 📋 数据格式要求

CSV文件必须包含以下列（列名必须完全匹配）：

| 列名 | 说明 | 示例 | 注意事项 |
|------|------|------|----------|
| 股票代码 | 股票代码 | AAPL, TSLA | 任意文本 |
| 期权类型 | sell call 或 sell put | sell call | 必须为 "sell call" 或 "sell put" |
| 执行日 | 期权到期日 | 2024-03-15 | 日期格式 YYYY-MM-DD |
| 执行价 | 期权执行价格 | 180.00 | 数字格式 |
| 期权价格 | 每股期权费 | 5.00 | **重要：输入每股期权费，不是每份合同总费用** |
| 每股均价 | 持仓成本价 | 175.00 | 数字格式 |
| 合同数量 | 期权合同份数 | 1 | 整数，每份合同对应100股 |

## 📊 输出结果

### 1. 详细分析结果
包含每笔期权交易的详细计算：
- **行权利润**：如果被行权的利润（考虑期权费和股价差额）
- **利润百分比**：相对于持仓金额的利润比例
- **盈利平衡价**：股价达到此价格时开始无利润
- **亏损平衡价**：股价跌到此价格时开始亏损

### 2. 股票汇总结果
按股票代码汇总：
- **总行权利润**：该股票所有期权交易的总利润
- **总利润百分比**：该股票的整体利润比例
- **加权平均成本价**：考虑合同数量的平均成本
- **汇总盈亏平衡价格**：该股票的盈亏平衡点

### 3. 可视化图表
- 各股票期权交易利润百分比柱状图
- 各股票盈亏平衡价格对比图

## 🧮 计算逻辑说明

### Sell Call 期权
- **行权利润** = 期权费 + (执行价 - 成本价) × 100股
- **盈利平衡价** = 执行价 + 每股期权费
- **亏损平衡价** = 成本价 - 每股期权费

### Sell Put 期权
- **行权利润** = 期权费 - (成本价 - 执行价) × 100股
- **盈利平衡价** = 执行价 - 每股期权费
- **亏损平衡价** = 成本价 + 每股期权费

## 💻 命令行参数

| 参数 | 简写 | 说明 | 示例 |
|------|------|------|------|
| --input | -i | 输入文件路径（CSV或Excel） | --input data.csv |
| --output | -o | 输出文件名前缀 | --output 我的分析 |
| --format | -f | 输出格式（csv或excel） | --format excel |
| --plot | -p | 生成图表 | --plot |
| --create-sample | -s | 创建示例数据文件 | --create-sample |

## 📈 示例

### 示例数据
```csv
股票代码,期权类型,执行日,执行价,期权价格,每股均价,合同数量
AAPL,sell call,2024-03-15,180,5.00,175,1
AAPL,sell put,2024-03-15,160,3.00,175,1
TSLA,sell call,2024-04-19,250,8.00,240,2
TSLA,sell put,2024-04-19,220,6.00,240,1
MSFT,sell call,2024-05-17,400,12.00,380,1
```

### 运行命令
```bash
python options_analyzer.py --input 示例期权数据.csv --plot
```

### 输出示例
```
================================================================================
期权交易分析摘要
================================================================================

总计分析 5 笔期权交易，涉及 3 只股票

各股票汇总分析:
--------------------------------------------------------------------------------
股票代码: AAPL
  总行权利润: 1,000.00 元
  总利润百分比: 2.86%
  加权平均成本价: 175.00 元
  汇总盈利平衡价: 182.50 元
  汇总亏损平衡价: 172.50 元
  总合同数量: 2 份

股票代码: TSLA
  总行权利润: 2,200.00 元
  总利润百分比: 4.58%
  加权平均成本价: 240.00 元
  汇总盈利平衡价: 253.33 元
  汇总亏损平衡价: 233.33 元
  总合同数量: 3 份

股票代码: MSFT
  总行权利润: 1,200.00 元
  总利润百分比: 3.16%
  加权平均成本价: 380.00 元
  汇总盈利平衡价: 412.00 元
  汇总亏损平衡价: 368.00 元
  总合同数量: 1 份

总体统计:
----------------------------------------
总行权利润: 4,400.00 元
总持仓金额: 95,000.00 元
总体利润百分比: 4.63%
================================================================================
```

## 📁 输出文件

分析完成后，会在 `output/` 目录下生成带时间戳的子目录，包含：
- `期权分析结果_详细.csv`：每笔交易的详细分析
- `期权分析结果_汇总.csv`：按股票汇总的结果
- `期权分析图表.png`：可视化图表（如果使用 --plot 参数）

## ⚠️ 注意事项

1. **期权价格输入**：输入每股期权费，不是每份合同的总费用
2. **数据格式**：确保数值字段只包含数字，日期格式为 YYYY-MM-DD
3. **期权类型**：必须为 "sell call" 或 "sell put"
4. **合同数量**：必须为正整数，每份合同对应100股
5. **文件编码**：建议使用UTF-8编码的CSV文件

## 🔧 故障排除

### 常见错误
1. **缺少必需的列**：检查CSV文件是否包含所有必需的列
2. **数据类型错误**：确保数值字段只包含数字
3. **期权类型错误**：确保期权类型为 "sell call" 或 "sell put"
4. **图表显示问题**：如果图表中文显示异常，可能需要安装中文字体
5. **文件路径错误**：确保输入文件路径正确

### 获取帮助
```bash
python options_analyzer.py --help
```

## 📦 依赖包

- pandas>=1.3.0：数据处理
- numpy>=1.21.0：数值计算
- matplotlib>=3.5.0：图表绘制
- seaborn>=0.11.0：统计图表
- openpyxl>=3.0.0：Excel文件支持 